# Development override - bind mounts code for live editing
# Usage: docker-compose up (automatically loads this file)
# Note: Run 'composer install' and build assets inside container after starting

version: '3.8'

services:
  app:
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
    volumes:
      - .:/var/www/html
      - ./storage:/var/www/html/storage
      - ./bootstrap/cache:/var/www/html/bootstrap/cache
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        composer install --no-interaction --prefer-dist
        php artisan octane:start --server=roadrunner --host=0.0.0.0 --port=8000 --watch

  scheduler:
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
    volumes:
      - .:/var/www/html
      - ./storage:/var/www/html/storage

  nginx:
    volumes:
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./public:/var/www/html/public:ro
      - ./storage/app/public:/var/www/html/storage/app/public:ro
